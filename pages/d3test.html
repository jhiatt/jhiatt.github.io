<!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="utf-8">
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="../css/materialize.min.css"  media="screen,projection"/>
<!--       <link type="text/css" rel="stylesheet" href="../css/pages.css"  media="screen,projection"/>
 -->      
      <title>D3 Test</title>

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <link rel="shortcut icon" href="../images/bike-favicon.ico" type="image/x-icon">

      <!-- link to d3 -->
      <script type='text/javascript' src="../d3/d3.js"></script>
    </head>

    <body class="case-study">
        <nav class="my-nav">
            <span class="small-nav" id="hamburger">
            <img src=".././images/hamburger-menue-icon.png" class=".small-nav" height="30" width="30" alt="">
            </span>
            <span class="big-nav" id="nav-span">
            
            <span class="nav-body">
                <a href="./../index.html">Home</a>
                <a href="mailto:jordanhiattcodes@gmail.com">Contact Me</a>
                <a href="../images/jordan-resume DME.pdf" download>Resume</a>

            </span>
            <span class="nav-side">
                <a href="https://github.com/jhiatt" target="_blank">
                <img src="./../images/GitHub-logo-square.png" alt="Github Profile" height="30" width="30" />
                </a>
                <a href="https://www.linkedin.com/in/jordanhiatt/" target="_blank">
                <img src="./../images/ln-black.png" alt="LinkedIn Profile" height="30" width="30" />
                </a>
                <a href="https://medium.com/@jhiatt" target="_blank">
                <img src="./../images/medium-monogram.png" alt="Medium Blog" height="30" width="30" />
                </a>
        <!--             <a target="_blank" href="">Design Make Experiment</a>  -->          
            </span>
            </span>
        </nav>


        <!-- NOTES:
            - helpful article: https://observablehq.com/@d3/zoom-to-bounding-box 
            - start local server: "python -m http.server 8888 &." launches http://localhost:8888/
            - 
        -->

        <script type='text/javascript'>
            
            // SVG SETUP
            // Establish the svg parameters
            var w = 1000;
            var h = 600;
            
            // Projection
            var projection = d3.geoAlbersUsa()
                               .translate([w/2, h/2]) //translate to move everything to the middle
            //    .scale([500]) //defalut scale for projection is 1000
            
            // Path
            var path = d3.geoPath()
                         .projection(projection);
            
            // Color
            var color = d3.scaleQuantize()
                          .range(['#fff7fb','#ece7f2','#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']) //thanks 'https://colorbrewer2.org/#type=sequential&scheme=PuBu&n=9'
            
            // Create SVG element
            var svg = d3.select('body')
                        .append('svg')
                        .attr('width', w)
                        .attr('height', h);
            
            // LOAD IN DATA

            
            // load in unemployment data
            d3.csv('https://raw.githubusercontent.com/jhiatt/county_data/main/cleaned_data/unemployment.csv').then(function(data) {
            
                // link data to color scale
                color.domain([
                    d3.min(data, function(d) { return d.Unemployment_rate}),
                    d3.max(data, function(d) { return d.Unemployment_rate})
                ]);

                // Loading GeoJason
                d3.json('https://raw.githubusercontent.com/jhiatt/county_data/main/cleaned_data/grouped_geojson.json').then(function(json) {
                    
                    // create a data object to store coordinates and unemployment info
                    var featuresLoaded = []

                    // Merge GeoJson data with unemp. data (loop through unemp)
                    // Still takes a few seconds to load, may need to combine in python before hand.  Requires duplicate code for each plot in this case.
                    for (var i = 0; i<data.length; i++) {
                        // pull FIPS from county
                        var dataFips = data[i].fips;
                        
                        // find unemp data value, convert to float
                        var dataValue = parseFloat(data[i].Unemployment_rate);
                        
                        // loop through the list of states
                        for (var j=0; j<json.features.length; j++) {
                            
                            if (dataFips.slice(0,2) == json.features[j].id) {

                                // loop through the counties for that state
                                stateCounties = json.features[j].properties.counties
                                for (var k=0; k<stateCounties.length; k++) {
                                    if (stateCounties[k].id == dataFips) {
                                        stateCounties[k].value = dataValue
                                        featuresLoaded.push(stateCounties[k])

                                        break;
                                    }
                                }

                                break;
                            }
                        }

                    }

                    // // Bind data to a single path with the GeoJason feature
                    // svg.selectAll('path')
                    //     .data(featuresLoaded)
                    //     .enter()
                    //     .append('path')
                    //     .attr('d', path)
                    //     .style('fill', function(d) {
                    //         //data value
                    //         var value = d.value;

                    //         if(value) {
                    //             return color(value); // pulls the color for that value established by d3 with d3.scaleQuantize().domain
                    //         } else {
                    //             return '#ccc'; // return gray if no value
                    //         }
                    //     })
                    
                    // not working, state lines not showing above county lines
                    svg.selectAll('path')
                        .data(json.features)
                        .enter()
                        .append('path')
                        .attr('d', path)
                        // .attr('stroke-width', '10px')
                        .attr("stroke", "white")
                        .attr('fill','none')

                    // Bind data to a single path with the GeoJason feature
                    svg.selectAll('path')
                        .data(featuresLoaded)
                        .enter()
                        .append('path')
                        .attr('d', path)
                        // .attr('stroke', 'white') //enable this with an option?
                        .style('fill', function(d) {
                            //data value
                            var value = d.value;

                            if(value) {
                                return color(value); // pulls the color for that value established by d3 with d3.scaleQuantize().domain
                            } else {
                                return '#ccc'; // return gray if no value
                            }
                        })
                })
            
            });
            
            </script>
            <div>
                <button>Unemployment Rate</button>
                <button>Presidential Election</button>
                <button>Population</button>
            </div>



<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="./../js/nav/navbar-mini.js"></script>
</body>
</html>